#!/bin/elvish

fn print_info {
  var info = (bspc wm -d)
  var focused-monitor-id = (echo $info | jq ".focusedMonitorId")
  var focused-monitor = 0

  range (echo $info | jq ".monitors | length") | each {|mid|
    if (== (echo $info | jq ".monitors["$mid"].id") $focused-monitor-id) {
      set focused-monitor = $mid
      break
    }
  }
  var monitor-info = (echo $info | jq -c ".monitors[] | select(.id == "$focused-monitor-id")")
  var focused-desktop-id = (echo $monitor-info | jq ".focusedDesktopId")
  var focused-desktop = (echo $monitor-info | jq -cr ".desktops[] | select(.id == "$focused-desktop-id").name")
  printf " %%{T2}%%{F#ff79c6}M %%{T-}%%{F-}%d %%{T2}%%{F#ff79c6}D %%{T-}%%{F-}%d\n" $focused-monitor $focused-desktop
}

print_info
bspc subscribe desktop_focus | eawk {|@args|
  print_info
}

